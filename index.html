<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt Studio (No-Install)</title>
  <style>
    :root{
      --bg:#0b0b10; --panel:#12121a; --panel2:#0f0f16;
      --line:#24243a; --text:#f2f2f6; --muted:rgba(242,242,246,.75);
      --chip:#0b0b10;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body{ margin:0; background:var(--bg); color:var(--text); }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(15,15,22,.9); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 14px; }
    h1{ margin:0; font-size:16px; letter-spacing:.2px; }
    .sub{ margin-top:6px; font-size:12px; color:var(--muted); line-height:1.35; }
    .grid{ display:grid; gap:12px; grid-template-columns:1fr; padding:14px; }
    @media (min-width:980px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:12px; }
    details{ background:var(--panel2); border:1px solid var(--line); border-radius:14px; padding:10px 12px; }
    details + details{ margin-top:10px; }
    summary{ cursor:pointer; font-weight:800; }
    .row{ display:grid; grid-template-columns: repeat(12,1fr); gap:10px; margin-top:10px; }
    .field{ grid-column: span 12; }
    @media (min-width:860px){
      .s6{ grid-column: span 6; }
      .s4{ grid-column: span 4; }
      .s3{ grid-column: span 3; }
    }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    select,input,textarea{
      width:100%; box-sizing:border-box;
      background:var(--bg); color:var(--text);
      border:1px solid #2f2f4a; border-radius:12px;
      padding:10px 10px; outline:none;
    }
    textarea{ min-height:220px; resize:vertical; }
    .btns{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    button{
      border:0; border-radius:12px; padding:10px 12px; cursor:pointer;
      background:var(--text); color:var(--bg); font-weight:800;
    }
    button.secondary{ background:#19192a; color:var(--text); border:1px solid #2f2f4a; font-weight:650; }
    .pill{ display:inline-block; padding:3px 8px; border:1px solid #2f2f4a; border-radius:999px; font-size:12px; color:var(--muted); }
    .tiny{ font-size:11px; color:rgba(242,242,246,.65); margin-top:6px; line-height:1.35; }
    .hr{ height:1px; background:var(--line); margin:12px 0; }
    .slider{ display:flex; gap:10px; align-items:center; }
    input[type="range"]{ width:100%; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{ display:flex; align-items:center; gap:8px; padding:8px 10px; background:var(--chip); border:1px solid #2f2f4a; border-radius:999px; }
    .chip input{ width:16px; height:16px; }
    .warn{ color:#ffcf6e; font-size:11px; margin-top:6px; }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Prompt Studio <span class="pill">v1.1 TEST</span>
    <div class="sub">
      Precision Prompt Engineering for Visual Creators
    </div>
  </div>
</header>

<div class="grid">
  <div class="card">
    <details open>
      <summary>Global Controls</summary>
      <div class="row">
        <div class="field s6">
          <label>Platform Mode</label>
          <select id="platformMode"></select>
        </div>
        <div class="field s6">
          <label>Verbosity</label>
          <div class="slider">
            <input id="verbosity" type="range" min="1" max="3" step="1" value="2">
            <span class="pill" id="verbosityLabel">Standard</span>
          </div>
          <div class="tiny">1 Minimal • 2 Standard • 3 Ultra</div>
        </div>

        <div class="field s6">
          <label>Seed (optional)</label>
          <input id="seed" value="4458271930" />
        </div>
        <div class="field s6">
          <label>Negative Prompt (optional)</label>
          <input id="negative" placeholder="e.g., low-res, extra fingers, warped face, text, watermark, logo" />
        </div>

        <div class="field">
          <label>
            <input id="brandToggle" type="checkbox" style="width:16px;height:16px;vertical-align:middle;margin-right:8px;">
            Private Brand Notes (NOT included in final prompt)
          </label>
          <div class="tiny">For your internal styling reference only. Output will never include brand names/notes.</div>
        </div>

        <div class="field s6" id="brandA" style="display:none;">
          <label>Private Brand Reference (stored only)</label>
          <select id="privateBrand"></select>
        </div>
        <div class="field s6" id="brandB" style="display:none;">
          <label>Private Brand Notes (stored only)</label>
          <input id="privateBrandNotes" placeholder="e.g., bag shape, heel silhouette, signature hardware vibe" />
        </div>
      </div>
    </details>

    <details open>
      <summary>Character <button class="secondary" type="button" id="rndCharacter" style="float:right;">Randomize</button></summary>
      <div class="row">
        <div class="field s6"><label>Character Type</label><select id="characterType"></select></div>
        <div class="field s6"><label>Style Preset</label><select id="stylePreset"></select></div>
        <div class="field s4"><label>Body Type</label><select id="bodyType"></select></div>
        <div class="field s4"><label>Complexion</label><select id="complexion"></select></div>
        <div class="field s4"><label>Undertone</label><select id="undertone"></select></div>
        <div class="field s6"><label>Expression</label><select id="expression"></select></div>
        <div class="field s6"><label>Pose</label><select id="pose"></select></div>
        <div class="field"><label>Custom Character Notes</label><input id="customCharacter" placeholder="Optional extras (freckles, dimples, glossy lips, etc.)"></div>
      </div>
    </details>

    <details>
      <summary>Hair <button class="secondary" type="button" id="rndHair" style="float:right;">Randomize</button></summary>
      <div class="row">
        <div class="field s3"><label>Texture</label><select id="hairTexture"></select></div>
        <div class="field s3"><label>Style</label><select id="hairStyle"></select></div>
        <div class="field s3"><label>Length</label><select id="hairLength"></select></div>
        <div class="field s3"><label>Part</label><select id="hairPart"></select></div>
        <div class="field s6"><label>Finish</label><select id="hairFinish"></select></div>
        <div class="field s6"><label>Accessories</label><select id="hairAccessories"></select></div>
        <div class="field"><label>Custom Hair Notes</label><input id="customHair" placeholder="Optional extras (laid edges, braid cuffs, curls framing face, etc.)"></div>
      </div>
    </details>

    <details>
      <summary>Beauty (Makeup, Lashes, Nails) <button class="secondary" type="button" id="rndBeauty" style="float:right;">Randomize</button></summary>
      <div class="row">
        <div class="field s4"><label>Base Finish</label><select id="baseFinish"></select></div>
        <div class="field s4"><label>Eyes</label><select id="eyeMakeup"></select></div>
        <div class="field s4"><label>Lips</label><select id="lipStyle"></select></div>

        <div class="field s3"><label>Lash Style</label><select id="lashStyle"></select></div>
        <div class="field s3"><label>Lash Length</label><select id="lashLength"></select></div>
        <div class="field s3"><label>Lash Curl</label><select id="lashCurl"></select></div>
        <div class="field s3"><label>Lash Density</label><select id="lashDensity"></select></div>

        <div class="field s3"><label>Nail Type</label><select id="nailType"></select></div>
        <div class="field s3"><label>Nail Length</label><select id="nailLength"></select></div>
        <div class="field s3"><label>Nail Shape</label><select id="nailShape"></select></div>
        <div class="field s3"><label>Nail Finish</label><select id="nailFinish"></select></div>

        <div class="field s4"><label>Nail Color</label><select id="nailColor"></select></div>
        <div class="field s4"><label>Nail Art</label><select id="nailArt"></select></div>
        <div class="field s4"><label>Accent</label><select id="nailAccent"></select></div>

        <div class="field"><label>Custom Beauty Notes</label><input id="customBeauty" placeholder="Optional extras (rhinestones, ombré lip liner, etc.)"></div>
      </div>
    </details>

    <details>
      <summary>Outfit <button class="secondary" type="button" id="rndOutfit" style="float:right;">Randomize</button></summary>
      <div class="row">
        <div class="field s6"><label>Outfit Aesthetic</label><select id="outfitAesthetic"></select></div>
        <div class="field s6"><label>Outfit Pieces</label><select id="outfitPieces"></select></div>
        <div class="field s4"><label>Fit</label><select id="outfitFit"></select></div>
        <div class="field s4"><label>Fabric</label><select id="outfitFabric"></select></div>
        <div class="field s4"><label>Pattern</label><select id="outfitPattern"></select></div>
        <div class="field s6"><label>Shoes</label><select id="shoes"></select></div>
        <div class="field s6"><label>Color Scheme</label><select id="colorScheme"></select></div>

        <div class="field s6">
          <label>Accessories (pick up to 3)</label>
          <div class="chips" id="accessoryChips"></div>
          <div class="warn" id="accWarn" style="display:none;">Pick up to 3 accessories.</div>
        </div>

        <div class="field s6">
          <label>Style Influence</label>
          <select id="styleInfluence"></select>
          <div class="tiny">Use “designer-inspired (no logos)” instead of brand names in output.</div>
        </div>

        <div class="field"><label>Custom Outfit Notes</label><input id="customOutfit" placeholder="Optional extras (gold hardware, layered jewelry, premium fit, etc.)"></div>
      </div>
    </details>

    <details>
      <summary>Scene & Camera <button class="secondary" type="button" id="rndScene" style="float:right;">Randomize</button></summary>
      <div class="row">
        <div class="field s6"><label>Setting</label><select id="setting"></select></div>
        <div class="field s6"><label>Lighting</label><select id="lighting"></select></div>
        <div class="field s4"><label>View</label><select id="view"></select></div>
        <div class="field s4"><label>Angle</label><select id="angle"></select></div>
        <div class="field s4"><label>Lens</label><select id="lens"></select></div>

        <div class="field s6">
          <label>Props (pick up to 3)</label>
          <div class="chips" id="propChips"></div>
          <div class="warn" id="propWarn" style="display:none;">Pick up to 3 props.</div>
        </div>

        <div class="field s6"><label>Theme</label><select id="theme"></select></div>
        <div class="field"><label>Extra Scene Notes</label><input id="extraScene" placeholder="Optional extras (skyline bokeh, soft shadows, calm mood, etc.)"></div>
      </div>
    </details>

    <details open>
      <summary>Presets & Output</summary>
      <div class="row">
        <div class="field s6"><label>Preset List</label><select id="presetList"></select></div>
        <div class="field s6"><label>Preset Name</label><input id="presetName" placeholder="e.g., Nova Reign Cozy Cafe"></div>
      </div>

      <div class="btns">
        <button id="btnGenerate">Generate Prompt</button>
        <button class="secondary" id="btnClear">Clear All</button>
        <button class="secondary" id="btnCopy">Copy</button>
        <button class="secondary" id="btnSave">Save Preset</button>
        <button class="secondary" id="btnLoad">Load Preset</button>
        <button class="secondary" id="btnExport">Export Presets</button>
        <button class="secondary" id="btnImport">Import Presets</button>
      </div>
      <input id="fileImport" type="file" accept="application/json" style="display:none;">
      <div class="tiny">Edit options easily inside the OPTIONS object in this file.</div>
    </details>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px;font-size:14px;opacity:.9;">Generated Prompt</h2>
    <textarea id="output" placeholder="Tap Generate Prompt…"></textarea>
    <div class="hr"></div>
    <div class="tiny">Platform formatting changes automatically. Private Brand Notes never output.</div>
  </div>
</div>

<script>
document.title = "JS RUNNING ✅";  
document.body.insertAdjacentHTML(
  "afterbegin",
  `<div id="dbgTop" style="position:fixed;top:8px;right:8px;z-index:99999;background:#22c55e;color:#000;padding:6px 10px;border-radius:10px;font:12px system-ui;">JS TOP ✅</div>`
);
document.body.insertAdjacentHTML("afterbegin", `<div style="position:fixed;top:8px;right:8px;z-index:99999;background:#22c55e;color:#000;padding:6px 10px;border-radius:10px;font:12px/1.2 system-ui;">JS TOP ✅</div>`);  
document.title = "JS LOADED ✅";
window.onerror = function (msg, src, line, col) {
  alert("JS error: " + msg + " @ line " + line + ":" + col);
};
  // ===== OPTIONS (edit freely) =====
  const OPTIONS = {
    platformMode: ["ImageFX","Midjourney","Stable Diffusion","ChatGPT","Microsoft Designer","Bing Image Creator","Grok"],
    privateBrand: ["None","Luxury house vibe (private)","Streetwear label vibe (private)","Minimal designer vibe (private)","90s supermodel vibe (private)","Custom (private)"],
    characterType: ["fictional human character","digital avatar character","fantasy character","paranormal character","stylized illustration character"],
    stylePreset: ["hyper-realistic lifestyle photo","cinematic editorial photo","glossy 3D stylized render","manhwa-inspired illustration","clean minimalist studio photo","street editorial photo","soft dreamy photo","high-contrast fashion photo","warm cozy candid photo","nighttime city cinematic photo"],
    bodyType: ["slim","curvy","plus-size","athletic","petite","tall statuesque"],
    complexion: ["deep brown","rich brown","medium brown","light brown","tan","olive","golden brown","porcelain"],
    undertone: ["warm undertone","neutral undertone","cool undertone","golden undertone","olive undertone"],
    expression: ["calm and focused","confident subtle smirk","soft smile","serious intense gaze","playful expression","cozy relaxed expression","boss energy expression","mysterious expression","flirty expression","peaceful expression"],
    pose: ["standing casually, relaxed posture","seated comfortably, legs tucked to the side","walking candidly mid-step","leaning against a wall, arms crossed","lounging on a couch, cozy posture","one hand on hip, confident stance","holding an item naturally, relaxed shoulders","looking over shoulder, soft attitude","hands in pockets, street style pose","sitting cross-legged, cozy vibe"],

    hairTexture: ["straight","wavy","curly","coily","kinky-curly"],
    hairStyle: ["sleek low bun","high ponytail","knotless braids","twists","loose curls","blowout","half-up half-down","bubble ponytail","space buns","short curly bob","braided ponytail"],
    hairLength: ["pixie","bob length","shoulder length","mid-back length","waist length"],
    hairPart: ["middle part","side part","no part","deep side part"],
    hairFinish: ["silky smooth finish","soft fluffy volume","defined curl definition","sleek edges","natural texture emphasis","high shine gloss"],
    hairAccessories: ["none","gold cuffs","hair clip","headband","silk scarf accent","pearls","bows"],

    baseFinish: ["dewy skin finish","soft matte finish","natural skin finish","glowy editorial finish","satin finish"],
    eyeMakeup: ["neutral browns","soft shimmer","smoky eye","pink-mauve tones","bronze glam","sharp liner + inner corner highlight","no-makeup makeup eyes","graphic liner accent"],
    lipStyle: ["glossy nude lips","matte nude lips","brown liner + gloss","red lip","soft ombré lip","deep berry lip","clear gloss","pink gloss"],

    lashStyle: ["natural wispy","soft volume","dramatic flutter","doll-eye","cat-eye mapping","spiky strip lash"],
    lashLength: ["short","medium","long","extra-long"],
    lashCurl: ["C-curl","D-curl","L-curl","soft curl"],
    lashDensity: ["light","medium","full","mega volume"],

    nailType: ["gel nails","acrylic nails","press-on nails"],
    nailLength: ["short","medium","long","extra-long"],
    nailShape: ["square","almond","coffin","stiletto","round"],
    nailFinish: ["glossy finish","matte finish","chrome reflective finish","glitter accent finish"],
    nailColor: ["nude","chocolate brown","glossy black","soft pink","red","milky white","silver chrome","gold chrome","espresso brown","deep burgundy"],
    nailArt: ["solid color","French tips","ombre fade","aura nails","marble effect","minimal line art","glazed donut","tortoise shell"],
    nailAccent: ["no accents","gold foil accents","rhinestone cuticle detail","3D charm accent","one accent nail"],

    outfitAesthetic: ["urban luxe streetwear","cozy chic neutrals","minimal upscale casual","editorial fashion vibe","dark romance edge","soft glam","boss babe corporate chic","street minimal","winter luxe","spring brunch chic"],
    outfitPieces: [
      "fitted turtleneck bodysuit with oversized wool coat",
      "oversized hoodie layered with cropped puffer jacket",
      "sleek dress with ribbed cardigan",
      "leather jacket with dark denim",
      "tailored blazer with fitted top and straight-leg pants",
      "matching knit set with long coat",
      "bodycon midi dress with trench coat"
    ],
    outfitFit: ["fitted silhouette","tailored fit","oversized layers","relaxed fit","snatched waist emphasis"],
    outfitFabric: ["soft knit","wool blend","denim","leather or faux leather","satin or silk","ribbed fabric","cashmere vibe"],
    outfitPattern: ["solid color","subtle texture","minimal print","plaid accent","monochrome","pinstripe"],
    shoes: ["clean white sneakers","chunky platform sneakers","knee-high boots","thigh-high boots","ankle boots","strappy heels","loafers"],
    colorScheme: ["neutral tones (black, brown, cream, gold accents)","monochrome black + silver","warm neutrals with soft beige highlights","dark moody palette with subtle neon accents","cream + camel + gold"],

    styleInfluence: ["original styling","designer-inspired silhouettes (no logos)","luxury-inspired styling (no logos)","streetwear editorial-inspired (no logos)"],

    theme: ["cozy urban reading vibe","nighttime city aesthetic","luxe café ambiance","minimal modern apartment vibe","rooftop skyline vibe","library corner vibe","studio backdrop vibe"],
    setting: ["urban luxe café with bookshelves and plush seating","modern city apartment book nook with warm lamp lighting","rooftop lounge with skyline bokeh","stylish library corner with marble and wood accents","minimal studio set, clean backdrop"],
    lighting: ["soft natural window light","warm ambient lamp lighting","moody cinematic lighting","neon city glow at night","golden hour sunlight","soft studio lighting"],
    view: ["full-body shot","three-quarter shot","waist-up portrait","close-up portrait"],
    angle: ["eye-level","slight low angle (power)","slight high angle (soft)","candid side angle","over-the-shoulder vibe"],
    lens: ["35mm cinematic depth of field","50mm portrait soft bokeh","wide angle clean modern look","editorial studio framing"],

    multiAccessories: ["gold hoop earrings","layered necklaces","stacked bangles","fashion glasses","sleek watch","statement rings","small shoulder bag (no logos)"],
    multiProps: ["holding a Kindle e-reader","holding a book","coffee cup nearby","stack of books nearby","open journal and pen","phone on table","soft throw blanket"]
  };

  // ========= UI Helpers =========
  const $ = (id) => document.getElementById(id);
  const KEY = "prompt_studio_presets_v1";

  function fillSelect(id, arr){
    const el = $(id);
    el.innerHTML = arr.map(v => `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`).join("");
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }
  function v(id){ return ($(id)?.value || "").trim(); }
  function randPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function setVerbosityLabel(){
    const n = Number($("verbosity").value);
    $("verbosityLabel").textContent = n===1 ? "Minimal" : n===2 ? "Standard" : "Ultra";
  }

  function renderChips(containerId, items, max, warnId){
    const box = $(containerId);
    box.innerHTML = "";
    items.forEach((label, idx) => {
      const chip = document.createElement("label");
      chip.className = "chip";
      chip.innerHTML = `<input type="checkbox"><span>${escapeHtml(label)}</span>`;
      box.appendChild(chip);
      chip.querySelector("span").textContent = label;
      chip.querySelector("input").addEventListener("change", () => {
        const checked = box.querySelectorAll("input:checked").length;
        $(warnId).style.display = checked > max ? "" : "none";
        if(checked > max){
          chip.querySelector("input").checked = false;
          $(warnId).style.display = "";
        }
      });
    });
  }
  function getChipSelections(containerId){
    const box = $(containerId);
    const out = [];
    box.querySelectorAll("label.chip").forEach(ch => {
      const cb = ch.querySelector("input");
      const text = ch.querySelector("span")?.textContent || "";
      if(cb && cb.checked && text) out.push(text);
    });
    return out;
  }
  function setChipSelections(containerId, selections){
    const set = new Set(selections || []);
    $(containerId).querySelectorAll("label.chip").forEach(ch => {
      const cb = ch.querySelector("input");
      const text = ch.querySelector("span")?.textContent || "";
      cb.checked = set.has(text);
    });
  }

  // ========= Presets =========
  function loadPresets(){
    try { return JSON.parse(localStorage.getItem(KEY) || "{}"); } catch { return {}; }
  }
  function savePresets(p){ localStorage.setItem(KEY, JSON.stringify(p)); }
  function refreshPresetList(){
    const presets = loadPresets();
    const names = Object.keys(presets).sort((a,b)=>a.localeCompare(b));
    const sel = $("presetList");
    sel.innerHTML = names.length
      ? names.map(n=>`<option value="${escapeHtml(n)}">${escapeHtml(n)}</option>`).join("")
      : `<option value="">(no presets yet)</option>`;
  }

  function captureState(){
    const state = {
      platformMode: v("platformMode"),
      verbosity: Number($("verbosity").value),
      seed: v("seed"),
      negative: v("negative"),
      brandToggle: $("brandToggle").checked,
      privateBrand: v("privateBrand"),
      privateBrandNotes: v("privateBrandNotes"),

      characterType: v("characterType"),
      stylePreset: v("stylePreset"),
      bodyType: v("bodyType"),
      complexion: v("complexion"),
      undertone: v("undertone"),
      expression: v("expression"),
      pose: v("pose"),
      customCharacter: v("customCharacter"),

      hairTexture: v("hairTexture"),
      hairStyle: v("hairStyle"),
      hairLength: v("hairLength"),
      hairPart: v("hairPart"),
      hairFinish: v("hairFinish"),
      hairAccessories: v("hairAccessories"),
      customHair: v("customHair"),

      baseFinish: v("baseFinish"),
      eyeMakeup: v("eyeMakeup"),
      lipStyle: v("lipStyle"),
      lashStyle: v("lashStyle"),
      lashLength: v("lashLength"),
      lashCurl: v("lashCurl"),
      lashDensity: v("lashDensity"),

      nailType: v("nailType"),
      nailLength: v("nailLength"),
      nailShape: v("nailShape"),
      nailFinish: v("nailFinish"),
      nailColor: v("nailColor"),
      nailArt: v("nailArt"),
      nailAccent: v("nailAccent"),
      customBeauty: v("customBeauty"),

      outfitAesthetic: v("outfitAesthetic"),
      outfitPieces: v("outfitPieces"),
      outfitFit: v("outfitFit"),
      outfitFabric: v("outfitFabric"),
      outfitPattern: v("outfitPattern"),
      shoes: v("shoes"),
      colorScheme: v("colorScheme"),
      styleInfluence: v("styleInfluence"),
      customOutfit: v("customOutfit"),
      accessoriesMulti: getChipSelections("accessoryChips"),

      setting: v("setting"),
      lighting: v("lighting"),
      view: v("view"),
      angle: v("angle"),
      lens: v("lens"),
      theme: v("theme"),
      extraScene: v("extraScene"),
      propsMulti: getChipSelections("propChips"),
    };
    return state;
  }

  function applyState(s){
    if(!s) return;
    fillVal("platformMode", s.platformMode);
    $("verbosity").value = String(s.verbosity ?? 2); setVerbosityLabel();
    $("seed").value = s.seed || "";
    $("negative").value = s.negative || "";

    $("brandToggle").checked = !!s.brandToggle;
    toggleBrandFields();
    fillVal("privateBrand", s.privateBrand);
    $("privateBrandNotes").value = s.privateBrandNotes || "";

    fillVal("characterType", s.characterType);
    fillVal("stylePreset", s.stylePreset);
    fillVal("bodyType", s.bodyType);
    fillVal("complexion", s.complexion);
    fillVal("undertone", s.undertone);
    fillVal("expression", s.expression);
    fillVal("pose", s.pose);
    $("customCharacter").value = s.customCharacter || "";

    fillVal("hairTexture", s.hairTexture);
    fillVal("hairStyle", s.hairStyle);
    fillVal("hairLength", s.hairLength);
    fillVal("hairPart", s.hairPart);
    fillVal("hairFinish", s.hairFinish);
    fillVal("hairAccessories", s.hairAccessories);
    $("customHair").value = s.customHair || "";

    fillVal("baseFinish", s.baseFinish);
    fillVal("eyeMakeup", s.eyeMakeup);
    fillVal("lipStyle", s.lipStyle);
    fillVal("lashStyle", s.lashStyle);
    fillVal("lashLength", s.lashLength);
    fillVal("lashCurl", s.lashCurl);
    fillVal("lashDensity", s.lashDensity);

    fillVal("nailType", s.nailType);
    fillVal("nailLength", s.nailLength);
    fillVal("nailShape", s.nailShape);
    fillVal("nailFinish", s.nailFinish);
    fillVal("nailColor", s.nailColor);
    fillVal("nailArt", s.nailArt);
    fillVal("nailAccent", s.nailAccent);
    $("customBeauty").value = s.customBeauty || "";

    fillVal("outfitAesthetic", s.outfitAesthetic);
    fillVal("outfitPieces", s.outfitPieces);
    fillVal("outfitFit", s.outfitFit);
    fillVal("outfitFabric", s.outfitFabric);
    fillVal("outfitPattern", s.outfitPattern);
    fillVal("shoes", s.shoes);
    fillVal("colorScheme", s.colorScheme);
    fillVal("styleInfluence", s.styleInfluence);
    $("customOutfit").value = s.customOutfit || "";
    setChipSelections("accessoryChips", s.accessoriesMulti || []);

    fillVal("setting", s.setting);
    fillVal("lighting", s.lighting);
    fillVal("view", s.view);
    fillVal("angle", s.angle);
    fillVal("lens", s.lens);
    fillVal("theme", s.theme);
    $("extraScene").value = s.extraScene || "";
    setChipSelections("propChips", s.propsMulti || []);
  }

  function fillVal(id, val){
    if(!$(id)) return;
    if(val) $(id).value = val;
  }

  // ========= Prompt Builder =========
  function buildPrompt(){
    const s = captureState();
    const mode = s.platformMode;
    const vb = s.verbosity;

    const accessories = (s.accessoriesMulti || []);
    const props = (s.propsMulti || []);
    const safeBrandLine = s.brandToggle ? "Style reference: luxury/designer-inspired (no logos)." : "";

    const subject = `Create an image of a ${s.characterType} in a ${s.stylePreset}.`;
    const appearance = `Body: ${s.bodyType}. Complexion: ${s.complexion} with a ${s.undertone}. Expression: ${s.expression}. Pose: ${s.pose}.`;
    const hair = `Hair: ${s.hairTexture} texture, ${s.hairStyle}, ${s.hairLength}, ${s.hairPart}, ${s.hairFinish}; accessories: ${s.hairAccessories}.`;
    const beauty = `Makeup: ${s.baseFinish}, eyes: ${s.eyeMakeup}, lips: ${s.lipStyle}. Lashes: ${s.lashStyle}, ${s.lashLength}, ${s.lashCurl}, ${s.lashDensity}. Nails: ${s.nailType}, ${s.nailLength}, ${s.nailShape}, ${s.nailColor}, ${s.nailFinish}, art: ${s.nailArt}, accent: ${s.nailAccent}.`;
    const outfit = `Outfit: ${s.outfitAesthetic} — ${s.outfitPieces}; fit: ${s.outfitFit}; fabric: ${s.outfitFabric}; pattern: ${s.outfitPattern}. Shoes: ${s.shoes}. Color scheme: ${s.colorScheme}. Influence: ${s.styleInfluence}.`;
    const extras = [
      accessories.length ? `Accessories: ${accessories.join(", ")}.` : "",
      props.length ? `Props: ${props.join(", ")}.` : "",
      s.customCharacter ? `Character notes: ${s.customCharacter}.` : "",
      s.customHair ? `Hair notes: ${s.customHair}.` : "",
      s.customBeauty ? `Beauty notes: ${s.customBeauty}.` : "",
      s.customOutfit ? `Outfit notes: ${s.customOutfit}.` : "",
      s.extraScene ? `Scene notes: ${s.extraScene}.` : "",
    ].filter(Boolean).join(" ");

    const scene = `Scene: ${s.setting}. Theme: ${s.theme}. Lighting: ${s.lighting}. Camera: ${s.view}, ${s.angle}, ${s.lens}.`;

    const constraints = `No logos, no brand marks, no text, no watermark.`;

    // verbosity
    const minimal = [subject, appearance, scene, safeBrandLine, constraints].filter(Boolean);
    const standard = [subject, appearance, hair, beauty, outfit, scene, extras, safeBrandLine, constraints].filter(Boolean);
    const ultra = [subject, appearance, hair, beauty, outfit, scene, extras, safeBrandLine, "Rendering: natural proportions, clean hands, realistic skin texture, cinematic depth of field.", constraints].filter(Boolean);

    const base = vb===1 ? minimal : vb===2 ? standard : ultra;

    // platform formatting
    if(mode === "ChatGPT"){
      return [
        "Subject: " + subject,
        "Appearance: " + appearance,
        "Hair: " + hair,
        "Beauty: " + beauty,
        "Outfit: " + outfit,
        "Scene & Camera: " + scene,
        extras ? ("Notes: " + extras) : "",
        safeBrandLine ? ("Style: " + safeBrandLine) : "",
        "Constraints: " + constraints,
        s.negative ? ("Negative: " + s.negative) : "",
        s.seed ? ("Seed: " + s.seed) : ""
      ].filter(Boolean).join("\n");
    }

    if(mode === "Microsoft Designer"){
      // single paragraph, concise
      const p = [subject, appearance, hair, outfit, scene, safeBrandLine, "No text, no logos."].filter(Boolean).join(" ");
      return p.replace(/\s+/g," ").trim();
    }

    if(mode === "Bing Image Creator"){
      const p = [subject, appearance, hair, outfit, scene, safeBrandLine, "No text, no logos."].filter(Boolean).join(" ");
      return p.replace(/\s+/g," ").trim();
    }

    if(mode === "Grok"){
      const p = [subject, appearance, hair, beauty, outfit, scene, extras, safeBrandLine, constraints].filter(Boolean).join("\n");
      return p + (s.seed ? `\nSeed: ${s.seed}.` : "");
    }

    if(mode === "Stable Diffusion"){
      return base.join("\n") +
        (s.negative ? `\nNegative: ${s.negative}` : "") +
        (s.seed ? `\nSeed: ${s.seed}` : "");
    }

    if(mode === "Midjourney"){
      const mj = base.join("\n") + (s.seed ? `\nSeed: ${s.seed}` : "");
      return mj + "\n--style raw --ar 4:5";
    }

    // ImageFX default
    return base.join("\n") +
      (s.negative ? `\nNegative: ${s.negative}` : "") +
      (s.seed ? `\nSeed: ${s.seed}` : "");
  }

  // ========= Actions =========
  function toggleBrandFields(){
    const on = $("brandToggle").checked;
    $("brandA").style.display = on ? "" : "none";
    $("brandB").style.display = on ? "" : "none";
  }

  function randomize(fields){
    fields.forEach(([id, arr]) => { $(id).value = randPick(arr); });
  }
  function randomizeChips(containerId, list, max){
    $(containerId).querySelectorAll("input[type=checkbox]").forEach(cb=>cb.checked=false);
    const n = Math.floor(Math.random()*(max+1));
    const picks = [...list].sort(()=>Math.random()-0.5).slice(0,n);
    setChipSelections(containerId, picks);
  }

  async function copyText(text){
    try { await navigator.clipboard.writeText(text); alert("Copied!"); }
    catch{
      const out = $("output"); out.focus(); out.select();
      document.execCommand("copy"); alert("Copied!");
    }
  }

  // ========= Init =========
  function init(){
    alert("Platform options count: " + OPTIONS.platformMode.length);
    console.log("OPTIONS:", OPTIONS);
    // fill selects
    Object.entries(OPTIONS).forEach(([k,arr])=>{
      if(k.startsWith("multi")) return;
      if($(k)) fillSelect(k, arr);
    });

    renderChips("accessoryChips", OPTIONS.multiAccessories, 3, "accWarn");
    renderChips("propChips", OPTIONS.multiProps, 3, "propWarn");

    $("verbosity").addEventListener("input", setVerbosityLabel);
    setVerbosityLabel();

    $("brandToggle").addEventListener("change", toggleBrandFields);

    $("btnGenerate").addEventListener("click", ()=> $("output").value = buildPrompt());
    $("btnCopy").addEventListener("click", ()=> copyText($("output").value || buildPrompt()));

    $("btnSave").addEventListener("click", ()=>{
  // 1) If you added autosave earlier, clear it so it doesn’t “restore” your old picks
  localStorage.removeItem("prompt_studio_autosave_v1");
  localStorage.removeItem("prompt_studio_autosave_v1"); // safe duplicate
  localStorage.removeItem("prompt_studio_autosave");    // in case you used this key
  });

    $("btnClear").addEventListener("click", () => {    
  // 2) Reset all dropdowns
  document.querySelectorAll("select").forEach(sel => {
    sel.selectedIndex = 0;
    sel.dispatchEvent(new Event("change", { bubbles: true }));
  });

  // 3) Clear ALL text inputs (including inputs with no type attribute)
  document.querySelectorAll("input").forEach(inp => {
    const type = (inp.type || "").toLowerCase();

    if (type === "file") return;
    if (type === "range") return;

    if (type === "checkbox") {
      inp.checked = false;
      inp.dispatchEvent(new Event("change", { bubbles: true }));
      return;
    }

    inp.value = "";
    inp.dispatchEvent(new Event("input", { bubbles: true }));
  });

  // 4) Clear textareas
  document.querySelectorAll("textarea").forEach(t => {
    t.value = "";
    t.dispatchEvent(new Event("input", { bubbles: true }));
  });

  // 5) Force-clear the chip selections (Accessories + Props) explicitly
  document.querySelectorAll("#accessoryChips input[type=checkbox]").forEach(cb => cb.checked = false);
  document.querySelectorAll("#propChips input[type=checkbox]").forEach(cb => cb.checked = false);

  // hide warnings
  if ($("accWarn")) $("accWarn").style.display = "none";
  if ($("propWarn")) $("propWarn").style.display = "none";

  // 6) Restore defaults you WANT
  $("verbosity").value = 2;
  setVerbosityLabel();
  if ($("seed")) $("seed").value = "4458271930";

  // brand section hide
  if ($("brandToggle")) $("brandToggle").checked = false;
  toggleBrandFields();

  // 7) Re-generate output
  $("output").value = buildPrompt();
}); 

  // Clear textareas
  document.querySelectorAll("textarea").forEach(t => t.value = "");

  // Restore defaults you want to keep
  $("verbosity").value = 2;
  setVerbosityLabel();

  // Optional: restore default seed
  $("seed").value = "4458271930";

  // Hide brand fields (since brandToggle gets unchecked)
  toggleBrandFields();

  // Hide any max-selection warnings
  const accWarn = $("accWarn"); if (accWarn) accWarn.style.display = "none";
  const propWarn = $("propWarn"); if (propWarn) propWarn.style.display = "none";

  // Rebuild output
  $("output").value = buildPrompt();
});
});
      const name = v("presetName") || prompt("Preset name?");
      if(!name) return;
      const presets = loadPresets();
      presets[name] = captureState();
      savePresets(presets);
      refreshPresetList();
      $("presetName").value = name;
      alert("Preset saved.");
    });

    $("btnLoad").addEventListener("click", ()=>{
      const name = v("presetList");
      const presets = loadPresets();
      if(!name || !presets[name]) return alert("No preset selected.");
      applyState(presets[name]);
      $("output").value = buildPrompt();
    });

    $("btnExport").addEventListener("click", ()=>{
      const presets = loadPresets();
      const blob = new Blob([JSON.stringify(presets, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "prompt-studio-presets.json"; a.click();
      URL.revokeObjectURL(url);
    });

    $("btnImport").addEventListener("click", ()=> $("fileImport").click());
    $("fileImport").addEventListener("change", async (e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      const text = await file.text();
      try{
        const imported = JSON.parse(text);
        const presets = loadPresets();
        Object.entries(imported).forEach(([k,val])=> presets[k]=val);
        savePresets(presets);
        refreshPresetList();
        alert("Imported presets.");
      } catch(err){
        alert("Import failed.");
      } finally {
        e.target.value = "";
      }
    });

    $("rndCharacter").addEventListener("click", ()=>{
      randomize([
        ["characterType", OPTIONS.characterType],
        ["stylePreset", OPTIONS.stylePreset],
        ["bodyType", OPTIONS.bodyType],
        ["complexion", OPTIONS.complexion],
        ["undertone", OPTIONS.undertone],
        ["expression", OPTIONS.expression],
        ["pose", OPTIONS.pose],
      ]);
      $("customCharacter").value = "";
    });

    $("rndHair").addEventListener("click", ()=>{
      randomize([
        ["hairTexture", OPTIONS.hairTexture],
        ["hairStyle", OPTIONS.hairStyle],
        ["hairLength", OPTIONS.hairLength],
        ["hairPart", OPTIONS.hairPart],
        ["hairFinish", OPTIONS.hairFinish],
        ["hairAccessories", OPTIONS.hairAccessories],
      ]);
      $("customHair").value = "";
    });

    $("rndBeauty").addEventListener("click", ()=>{
      randomize([
        ["baseFinish", OPTIONS.baseFinish],
        ["eyeMakeup", OPTIONS.eyeMakeup],
        ["lipStyle", OPTIONS.lipStyle],
        ["lashStyle", OPTIONS.lashStyle],
        ["lashLength", OPTIONS.lashLength],
        ["lashCurl", OPTIONS.lashCurl],
        ["lashDensity", OPTIONS.lashDensity],
        ["nailType", OPTIONS.nailType],
        ["nailLength", OPTIONS.nailLength],
        ["nailShape", OPTIONS.nailShape],
        ["nailFinish", OPTIONS.nailFinish],
        ["nailColor", OPTIONS.nailColor],
        ["nailArt", OPTIONS.nailArt],
        ["nailAccent", OPTIONS.nailAccent],
      ]);
      $("customBeauty").value = "";
    });

    $("rndOutfit").addEventListener("click", ()=>{
      randomize([
        ["outfitAesthetic", OPTIONS.outfitAesthetic],
        ["outfitPieces", OPTIONS.outfitPieces],
        ["outfitFit", OPTIONS.outfitFit],
        ["outfitFabric", OPTIONS.outfitFabric],
        ["outfitPattern", OPTIONS.outfitPattern],
        ["shoes", OPTIONS.shoes],
        ["colorScheme", OPTIONS.colorScheme],
        ["styleInfluence", OPTIONS.styleInfluence],
      ]);
      randomizeChips("accessoryChips", OPTIONS.multiAccessories, 3);
      $("customOutfit").value = "";
    });

    $("rndScene").addEventListener("click", ()=>{
      randomize([
        ["setting", OPTIONS.setting],
        ["lighting", OPTIONS.lighting],
        ["view", OPTIONS.view],
        ["angle", OPTIONS.angle],
        ["lens", OPTIONS.lens],
        ["theme", OPTIONS.theme],
      ]);
      randomizeChips("propChips", OPTIONS.multiProps, 3);
      $("extraScene").value = "";
    });

    refreshPresetList();
    $("output").value = buildPrompt();
  }

  document.addEventListener("DOMContentLoaded", () => {
  try {
    init();
  } catch (e) {
    alert("Init error: " + (e?.message || e));
  }
});
document.body.insertAdjacentHTML(
  "afterbegin",
  `<div id="dbgBottom" style="position:fixed;top:44px;right:8px;z-index:99999;background:#60a5fa;color:#000;padding:6px 10px;border-radius:10px;font:12px system-ui;">JS BOTTOM ✅</div>`
);  
</script>
</body>
</html>
